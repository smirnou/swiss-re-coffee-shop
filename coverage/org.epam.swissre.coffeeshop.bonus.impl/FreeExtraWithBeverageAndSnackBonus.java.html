<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FreeExtraWithBeverageAndSnackBonus.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Swiss Re Coffee Shop</a> &gt; <a href="index.source.html" class="el_package">org.epam.swissre.coffeeshop.bonus.impl</a> &gt; <span class="el_source">FreeExtraWithBeverageAndSnackBonus.java</span></div><h1>FreeExtraWithBeverageAndSnackBonus.java</h1><pre class="source lang-java linenums">package org.epam.swissre.coffeeshop.bonus.impl;

import org.epam.swissre.coffeeshop.bonus.BonusStrategy;
import org.epam.swissre.coffeeshop.model.*;

import java.util.List;
import java.util.Random;

/**
 * A promotional strategy that provides a specific free extra item
 * when a customer purchases at least one beverage and one snack.
 * This promotion assumes a specific predefined extra item (e.g., Extra Milk)
 * that is added to the order for free under qualifying conditions.
 */
<span class="fc" id="L15">public class FreeExtraWithBeverageAndSnackBonus implements BonusStrategy {</span>

<span class="fc" id="L17">    final Random random = new Random();</span>

    /**
     * Applies the promotion by adding a free Extra Item to the order if it contains
     * at least one beverage and one snack.
     *
     * @param order The order to which the promotional logic will be applied.
     */
    @Override
    public void apply(Order order) {
<span class="fc" id="L27">        final List&lt;Product&gt; products = order.getProducts();</span>
<span class="fc" id="L28">        boolean hasBeverage = hasBeverage(products);</span>
<span class="fc" id="L29">        boolean hasSnack = hasSnack(products);</span>

<span class="fc bfc" id="L31" title="All 4 branches covered.">        if (hasBeverage &amp;&amp; hasSnack) {</span>
<span class="fc" id="L32">            final List&lt;Product&gt; extraItems = getExtraItems(products);</span>
<span class="fc bfc" id="L33" title="All 2 branches covered.">            if (!extraItems.isEmpty()) {</span>
<span class="fc" id="L34">                Product freeExtra = selectRandomExtraItem(extraItems);</span>
                // add extra price as discount
<span class="fc" id="L36">                order.applyDiscount(freeExtra.getPrice());</span>
            } /* else the discount is not provided because product list does not include beverage and snacks
                (in the actual production code you can add a logger to log the exception case) */

        } /* else the discount is not provided because there are no beverage and snacks in the product list
            (in the actual production code you can add a logger to log the exception case) */
<span class="fc" id="L42">    }</span>

    private boolean hasBeverage(List&lt;Product&gt; products) {
<span class="fc" id="L45">        return products.stream().anyMatch(i -&gt; i instanceof BeverageProduct);</span>
    }

    private boolean hasSnack(List&lt;Product&gt; products) {
<span class="fc" id="L49">        return products.stream().anyMatch(i -&gt; i instanceof BaconRoll);</span>
    }

    private List&lt;Product&gt; getExtraItems(List&lt;Product&gt; products) {
<span class="fc" id="L53">        return products.stream().filter(i -&gt; i instanceof ExtraItem).toList();</span>
    }

    // Revised method to select a random extra item correctly
    private Product selectRandomExtraItem(List&lt;Product&gt; extras) {
<span class="fc" id="L58">        int index = random.nextInt(extras.size()); // Safe now since you check isEmpty() prior</span>
<span class="fc" id="L59">        return extras.get(index);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>